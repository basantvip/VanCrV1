<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Add Product - Vanshika Creations - VanCr</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="assets/images/p009.png" />
  <style>
    .form-section { margin-bottom: 24px; }
    .form-section label { display: block; margin-bottom: 8px; font-weight: 600; }
    .form-section input[type="text"],
    .form-section input[type="file"] {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 14px;
    }
    .checkbox-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; margin-top: 8px; }
    .checkbox-item { display: flex; align-items: center; gap: 8px; }
    .checkbox-item input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
    .checkbox-item label { cursor: pointer; margin: 0; font-weight: normal; }
    .image-preview { margin-top: 12px; max-width: 300px; border: 2px dashed var(--border); border-radius: 8px; padding: 8px; display: none; }
    .image-preview img { width: 100%; height: auto; border-radius: 4px; }
    .btn-group { display: flex; gap: 12px; margin-top: 24px; }
  </style>
</head>
<body>
  <script src="auth-nav.js"></script>
  <script>
    // Check if user is admin on page load
    (function() {
      const userStr = localStorage.getItem('user') || sessionStorage.getItem('user');
      if (!userStr) {
        alert('Please login to access this page.');
        window.location.href = 'login.html';
        return;
      }
      
      const user = JSON.parse(userStr);
      if (user.accessLevel !== 'Admin') {
        alert('Access denied. This page is only accessible to administrators.');
        window.location.href = 'index.html';
        return;
      }
    })();
  </script>
  <div class="top-banner" role="region" aria-label="Announcement">
    <img class="banner-logo" src="assets/images/vancr.png" alt="VanCr logo">
    <div class="banner-inner">
      <span>VanCr For Premium Kids Wear — Where Comfort Meets Cuteness!</span>
    </div>
  </div>
  <header class="site-header">
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="catalog.html">Catalog</a>
      <a href="contact.html">Contact Us</a>
    </nav>
  </header>
  <main class="content">
    <h1>Add New Product</h1>
    
    <form id="product-form" enctype="multipart/form-data">
      
      <div class="form-section">
        <label for="item-price">Price (₹) *</label>
        <input type="number" id="item-price" name="price" required min="0" step="0.01" placeholder="e.g., 599.00">
      </div>

      <div class="form-section">
        <label for="item-image">Product Image *</label>
        <input type="file" id="item-image" name="itemImage" accept="image/*" required>
        <div id="image-preview" class="image-preview">
          <img id="preview-img" src="" alt="Preview">
        </div>
      </div>

      <div class="form-section">
        <label>Categories *</label>
        <div class="checkbox-group">
          <div class="checkbox-item"><input type="checkbox" id="cat-girls" name="categories" value="Girls"><label for="cat-girls">Girls</label></div>
          <div class="checkbox-item"><input type="checkbox" id="cat-boys" name="categories" value="Boys"><label for="cat-boys">Boys</label></div>
          <div class="checkbox-item"><input type="checkbox" id="cat-baby" name="categories" value="Baby"><label for="cat-baby">Baby</label></div>
          <div class="checkbox-item"><input type="checkbox" id="cat-accessories" name="categories" value="Accessories"><label for="cat-accessories">Accessories</label></div>
          <div class="checkbox-item"><input type="checkbox" id="cat-footwear" name="categories" value="Footwear"><label for="cat-footwear">Footwear</label></div>
        </div>
      </div>

      <div class="form-section">
        <label>Age Groups *</label>
        <div class="checkbox-group">
          <div class="checkbox-item"><input type="checkbox" id="age-newborn" name="ageGroups" value="Newborn"><label for="age-newborn">Newborn (0-3 months)</label></div>
          <div class="checkbox-item"><input type="checkbox" id="age-infant" name="ageGroups" value="Infant"><label for="age-infant">Infant (3-12 months)</label></div>
          <div class="checkbox-item"><input type="checkbox" id="age-toddler" name="ageGroups" value="Toddler"><label for="age-toddler">Toddler (1-3 years)</label></div>
          <div class="checkbox-item"><input type="checkbox" id="age-preschool" name="ageGroups" value="Preschool"><label for="age-preschool">Preschool (3-5 years)</label></div>
          <div class="checkbox-item"><input type="checkbox" id="age-kids" name="ageGroups" value="Kids"><label for="age-kids">Kids (5+ years)</label></div>
        </div>
      </div>

      <div class="form-section">
        <label>Season</label>
        <div class="checkbox-group">
          <div class="checkbox-item"><input type="checkbox" id="season-summer" name="seasons" value="Summer"><label for="season-summer">Summer</label></div>
          <div class="checkbox-item"><input type="checkbox" id="season-winter" name="seasons" value="Winter"><label for="season-winter">Winter</label></div>
          <div class="checkbox-item"><input type="checkbox" id="season-spring" name="seasons" value="Spring"><label for="season-spring">Spring</label></div>
          <div class="checkbox-item"><input type="checkbox" id="season-fall" name="seasons" value="Fall"><label for="season-fall">Fall</label></div>
          <div class="checkbox-item"><input type="checkbox" id="season-allseason" name="seasons" value="All Season"><label for="season-allseason">All Season</label></div>
        </div>
      </div>

      <div class="form-section">
        <label>Occasion</label>
        <div class="checkbox-group">
          <div class="checkbox-item"><input type="checkbox" id="occ-casual" name="occasions" value="Casual"><label for="occ-casual">Casual</label></div>
          <div class="checkbox-item"><input type="checkbox" id="occ-formal" name="occasions" value="Formal"><label for="occ-formal">Formal</label></div>
          <div class="checkbox-item"><input type="checkbox" id="occ-party" name="occasions" value="Party"><label for="occ-party">Party</label></div>
          <div class="checkbox-item"><input type="checkbox" id="occ-traditional" name="occasions" value="Traditional"><label for="occ-traditional">Traditional</label></div>
          <div class="checkbox-item"><input type="checkbox" id="occ-everyday" name="occasions" value="Everyday"><label for="occ-everyday">Everyday</label></div>
        </div>
      </div>

      <div class="btn-group">
        <button type="submit" class="btn primary">Add Product</button>
        <button type="reset" class="btn">Clear Form</button>
      </div>
    </form>

    <div id="status-message" style="margin-top: 24px;"></div>

  </main>
  <footer class="site-footer">
    <div>© 2025 Vanshika Creations - VanCr · All rights reserved.</div>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
    </div>
  </footer>

  <script>
    // Image preview
    document.getElementById('item-image').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          document.getElementById('preview-img').src = event.target.result;
          document.getElementById('image-preview').style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    // Form submission
    document.getElementById('product-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = this.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = 'Uploading...';

      const statusDiv = document.getElementById('status-message');
      statusDiv.textContent = '';
      statusDiv.className = '';

      // Collect form data
      const formData = new FormData();
      formData.append('price', document.getElementById('item-price').value);
      formData.append('itemImage', document.getElementById('item-image').files[0]);
      
      // Collect checked values
      const categories = Array.from(document.querySelectorAll('input[name="categories"]:checked')).map(cb => cb.value);
      const ageGroups = Array.from(document.querySelectorAll('input[name="ageGroups"]:checked')).map(cb => cb.value);
      const seasons = Array.from(document.querySelectorAll('input[name="seasons"]:checked')).map(cb => cb.value);
      const occasions = Array.from(document.querySelectorAll('input[name="occasions"]:checked')).map(cb => cb.value);

      if (categories.length === 0) {
        statusDiv.textContent = 'Please select at least one category.';
        statusDiv.style.cssText = 'padding:12px; background:#ffe6e6; color:#c40000; border-radius:6px;';
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        return;
      }

      if (ageGroups.length === 0) {
        statusDiv.textContent = 'Please select at least one age group.';
        statusDiv.style.cssText = 'padding:12px; background:#ffe6e6; color:#c40000; border-radius:6px;';
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        return;
      }

      formData.append('categories', JSON.stringify(categories));
      formData.append('ageGroups', JSON.stringify(ageGroups));
      formData.append('seasons', JSON.stringify(seasons));
      formData.append('occasions', JSON.stringify(occasions));

      try {
        // Get user info for authorization header
        const userStr = localStorage.getItem('user') || sessionStorage.getItem('user');
        const user = userStr ? JSON.parse(userStr) : null;
        
        if (!user || !user.userId) {
          statusDiv.textContent = '❌ Please login to add products.';
          statusDiv.style.cssText = 'padding:12px; background:#ffe6e6; color:#c40000; border-radius:6px;';
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
          return;
        }
        
        const endpoint = window.PRODUCT_API_ENDPOINT || 'http://localhost:8000/api/add-product';
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: {
            'X-User-Id': user.userId
          },
          body: formData
        });

        const data = await res.json();

        if (res.ok && data.ok) {
          statusDiv.textContent = `✅ Product added successfully! Price: ₹${data.price} | Item ID: ${data.itemId}`;
          statusDiv.style.cssText = 'padding:16px; background:#e6ffed; color:#0a5f2b; border-radius:8px; font-weight:600;';
          this.reset();
          document.getElementById('image-preview').style.display = 'none';
          
          setTimeout(() => {
            statusDiv.style.transition = 'opacity 0.5s';
            statusDiv.style.opacity = '0';
            setTimeout(() => { statusDiv.textContent = ''; statusDiv.style.cssText = ''; statusDiv.style.opacity = '1'; }, 500);
          }, 5000);
        } else {
          statusDiv.textContent = `❌ Error: ${data.error || 'Failed to add product'}`;
          statusDiv.style.cssText = 'padding:12px; background:#ffe6e6; color:#c40000; border-radius:6px;';
        }
      } catch (err) {
        console.error('Network error:', err);
        statusDiv.textContent = '❌ Could not reach server. Please ensure backend is running.';
        statusDiv.style.cssText = 'padding:12px; background:#ffe6e6; color:#c40000; border-radius:6px;';
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });
  </script>
</body>
</html>
