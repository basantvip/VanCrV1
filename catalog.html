<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vanshika Creations - VanCr | Catalog</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="assets/images/p009.png" />
</head>
<body>
  <script src="auth-nav.js"></script>
  <div class="top-banner" role="region" aria-label="Announcement">
    <img class="banner-logo" src="assets/images/vancr.png" alt="VanCr logo">
    <div class="banner-inner">
      <span>VanCr For Premium Kids Wear â€” Where Comfort Meets Cuteness!</span>
    </div>
  </div>
  <header class="site-header">
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="shop.html">Shop</a>
      <a href="catalog.html">Catalog</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a class="cart-link" href="cart.html">ðŸ›’ <span id="cart-count">0</span></a>
    </nav>
  </header>
  <main class="content">

<section>
  <h1>Catalog</h1>
  <div class="filters">
    <input id="search" type="search" placeholder="Search products" />
    <select id="category">
      <option value="">All Categories</option>
      <option value="Girls">Girls</option>
      <option value="Boys">Boys</option>
      <option value="Baby">Baby</option>
      <option value="Accessories">Accessories</option>
      <option value="Footwear">Footwear</option>
    </select>
    <select id="ageGroup">
      <option value="">All Age Groups</option>
      <option value="Newborn">Newborn (0-3 months)</option>
      <option value="Infant">Infant (3-12 months)</option>
      <option value="Toddler">Toddler (1-3 years)</option>
      <option value="Preschool">Preschool (3-5 years)</option>
      <option value="Kids">Kids (5+ years)</option>
    </select>
    <select id="season">
      <option value="">All Seasons</option>
      <option value="Spring">Spring</option>
      <option value="Summer">Summer</option>
      <option value="Fall">Fall</option>
      <option value="Winter">Winter</option>
      <option value="All Season">All Season</option>
    </select>
    <select id="occasion">
      <option value="">All Occasions</option>
      <option value="Casual">Casual</option>
      <option value="Formal">Formal</option>
      <option value="Party">Party</option>
      <option value="Traditional">Traditional</option>
      <option value="Everyday">Everyday</option>
    </select>
  </div>
  <div id="loading" style="display:none; text-align:center; padding:2rem;">Loading products...</div>
  <div id="catalog-grid" class="grid"></div>
</section>
  </main>
  <footer class="site-footer">
    <div>Â© 2025 Vanshika Creations - VanCr Â· All rights reserved.</div>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
    </div>
  </footer>
  <script src="app.js"></script>
  <script>
    // Catalog page - load products from backend
    // Use current hostname for mobile device support, fallback to localhost
    const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
      ? 'http://localhost:8000' 
      : `http://${window.location.hostname}:8000`;
    const catalogGrid = document.getElementById('catalog-grid');
    const loadingDiv = document.getElementById('loading');
    const searchInput = document.getElementById('search');
    const categorySelect = document.getElementById('category');
    const ageGroupSelect = document.getElementById('ageGroup');
    const seasonSelect = document.getElementById('season');
    const occasionSelect = document.getElementById('occasion');

    let allProducts = [];

    // Read URL parameters and set filter values
    function initializeFiltersFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      
      const category = urlParams.get('category');
      const ageGroup = urlParams.get('ageGroup');
      const season = urlParams.get('season');
      const occasion = urlParams.get('occasion');
      
      if (category) categorySelect.value = category;
      if (ageGroup) ageGroupSelect.value = ageGroup;
      if (season) seasonSelect.value = season;
      if (occasion) occasionSelect.value = occasion;
    }

    async function loadProducts() {
      try {
        loadingDiv.style.display = 'block';
        catalogGrid.innerHTML = '';
        
        const params = new URLSearchParams();
        if (categorySelect.value) params.append('category', categorySelect.value);
        if (ageGroupSelect.value) params.append('ageGroup', ageGroupSelect.value);
        if (seasonSelect.value) params.append('season', seasonSelect.value);
        if (occasionSelect.value) params.append('occasion', occasionSelect.value);
        
        const response = await fetch(`${API_BASE}/api/products?${params}`);
        const data = await response.json();
        
        if (data.ok) {
          allProducts = data.products;
          displayProducts(allProducts);
        } else {
          catalogGrid.innerHTML = '<p style="grid-column: 1/-1; text-align:center;">Error loading products</p>';
        }
      } catch (error) {
        console.error('Error:', error);
        catalogGrid.innerHTML = '<p style="grid-column: 1/-1; text-align:center;">Failed to load products. Make sure backend is running.</p>';
      } finally {
        loadingDiv.style.display = 'none';
      }
    }

    function displayProducts(products) {
      if (products.length === 0) {
        catalogGrid.innerHTML = '<p style="grid-column: 1/-1; text-align:center;">No products found</p>';
        return;
      }

      catalogGrid.innerHTML = products.map(product => `
        <div class="product-card">
          <img src="${product.imageUrl}" alt="Product" style="width:100%; height:200px; object-fit:cover; border-radius:8px;" />
          <h3 style="margin:0.5rem 0; font-size:1.2rem; color:#2c5f2d;">â‚¹${product.price || 0}</h3>
          <div style="font-size:0.85rem; color:#666;">
            ${product.categories.map(c => `<span style="background:#e3f2fd; padding:2px 6px; border-radius:3px; margin:2px;">${c}</span>`).join('')}
          </div>
          <div style="font-size:0.75rem; color:#888; margin-top:0.25rem;">
            ${product.ageGroups.join(', ')}
          </div>
        </div>
      `).join('');
    }

    function filterProducts() {
      const searchTerm = searchInput.value.toLowerCase();
      const filtered = allProducts.filter(p => 
        p.price.toString().includes(searchTerm) ||
        p.categories.some(c => c.toLowerCase().includes(searchTerm)) ||
        p.ageGroups.some(a => a.toLowerCase().includes(searchTerm))
      );
      displayProducts(filtered);
    }

    // Event listeners
    categorySelect.addEventListener('change', loadProducts);
    ageGroupSelect.addEventListener('change', loadProducts);
    seasonSelect.addEventListener('change', loadProducts);
    occasionSelect.addEventListener('change', loadProducts);
    searchInput.addEventListener('input', filterProducts);

    // Initialize filters from URL and load products
    initializeFiltersFromURL();
    loadProducts();
  </script>
</body>
</html>